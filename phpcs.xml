<ruleset name="default">
    <description>Project Coding Standard</description>

    <exclude-pattern>*/data/*</exclude-pattern>
    <exclude-pattern>*/vendor/*</exclude-pattern>
    <exclude-pattern>*/public/js/*</exclude-pattern>
    <exclude-pattern>*/public/css/*</exclude-pattern>
    <!-- ignore until merged with allen_ansible -->
    <exclude-pattern>*/build/xdebug-filter.php</exclude-pattern>

    <!-- commandline parameter equivalents -->
    <!-- use the "colors" commandline parameter for colored output - not here as colors don't work well with Jenkins log -->
    <arg value="p"/>
    <arg name="extensions" value="php" />
    <arg name="basepath" value="." />

    <!-- severity is 0 - 10, where 10 is highest and 0 is "hidden" (special) -->
    <!-- By default CodeSniffer hides anything below 5, and default level for sniffs is 5 -->
    <arg name="severity" value="1" />

    <rule ref="Internal.NoCodeFound">
        <exclude-pattern>*/App/Views/*</exclude-pattern>
    </rule>
    <!--
    <rule ref="PHPCompatibility">
        <include-pattern>*\.php</include-pattern>
    </rule>
    -->

    <rule ref="PSR1">
        <severity>10</severity>
    </rule>
    <!-- We allow views to define functions which may be used as part of building that view -->
    <rule ref="PSR1.Files.SideEffects.FoundWithSymbols">
        <exclude-pattern>*/App/Views/*</exclude-pattern>
    </rule>
    <rule ref="PSR2.Files.ClosingTag.NotAllowed">
        <exclude-pattern>*/App/Views/*</exclude-pattern>
    </rule>

    <rule ref="PSR2">
        <!-- Between GIT, PSR-1/2/12 and the fact that it very rarely actually matters, we'll ignore this -->
        <exclude name="Generic.Files.LineEndings" />
        <!-- We don't work on 80 char wide terminals any more -->
        <exclude name="Generic.Files.LineLength" />
        <!-- Superceded by PSR-12 -->
        <exclude name="PSR2.ControlStructures.ControlStructureSpacing.SpacingAfterOpenBrace" />
    </rule>
    <rule ref="PSR12">
        <!-- See PSR-2 comments -->
        <exclude name="Generic.Files.LineEndings" />
        <exclude name="Generic.Files.LineLength" />
        <!-- Not supported by PHPStorm yet -->
        <exclude name="PSR12.Files.FileHeader.SpacingAfterBlock" />
    </rule>

    <rule ref="Generic.Arrays.ArrayIndent" />
    <rule ref="Generic.Arrays.DisallowLongArraySyntax" />
    <rule ref="Generic.CodeAnalysis.AssignmentInCondition" />
    <!-- While this should be avoided, it can be warranted in some cases -->
    <rule ref="Generic.CodeAnalysis.EmptyStatement">
        <type>warning</type>
    </rule>
    <rule ref="Generic.CodeAnalysis.ForLoopShouldBeWhileLoop"/>
    <rule ref="Generic.CodeAnalysis.ForLoopWithTestFunctionCall" />
    <rule ref="Generic.CodeAnalysis.JumbledIncrementer"/>
    <rule ref="Generic.CodeAnalysis.UnconditionalIfStatement"/>
    <rule ref="Generic.CodeAnalysis.UnnecessaryFinalModifier"/>
    <rule ref="Generic.CodeAnalysis.UselessOverridingMethod"/>
    <rule ref="Generic.ControlStructures.InlineControlStructure" />
    <rule ref="Generic.Files.ByteOrderMark"/>
    <rule ref="Generic.Files.EndFileNewline">
        <exclude-pattern>*/App/Views/*</exclude-pattern>
    </rule>
    <rule ref="Generic.Files.InlineHTML">
        <type>warning</type>
        <exclude-pattern>*/App/Views/*</exclude-pattern>
        <exclude-pattern>*/default/index.php</exclude-pattern>
    </rule>
    <!--
    <rule ref="Generic.Files.LineLength">
        <properties>
            <property name="lineLimit" value="120" />
            <property name="absoluteLineLimit" value="0" />
        </properties>
    </rule>
    -->
    <rule ref="Generic.Files.OneClassPerFile">
        <type>error</type>
        <severity>10</severity>
    </rule>
    <rule ref="Generic.Files.OneInterfacePerFile">
        <type>error</type>
        <severity>10</severity>
    </rule>
    <rule ref="Generic.Files.OneObjectStructurePerFile">
        <type>error</type>
        <severity>10</severity>
    </rule>
    <rule ref="Generic.Files.OneTraitPerFile">
        <type>error</type>
        <severity>10</severity>
    </rule>
    <rule ref="Generic.Formatting.DisallowMultipleStatements"/>
    <rule ref="Generic.Formatting.SpaceAfterCast" />
    <rule ref="Generic.Metrics.NestingLevel">
        <severity>7</severity>
        <properties>
            <property name="nestingLevel" value="5" />
            <property name="absoluteNestingLevel" value="7" />
        </properties>
    </rule>
    <rule ref="Generic.PHP.BacktickOperator" />
    <rule ref="Generic.PHP.CharacterBeforePHPOpeningTag">
        <exclude-pattern>*/App/Views/*</exclude-pattern>
    </rule>
    <rule ref="Generic.PHP.DeprecatedFunctions">
        <severity>7</severity>
        <type>error</type>
    </rule>
    <rule ref="Generic.PHP.DisallowAlternativePHPTags">
        <type>error</type>
        <severity>10</severity>
    </rule>
    <rule ref="Generic.PHP.DisallowShortOpenTag">
        <type>error</type>
        <severity>10</severity>
    </rule>
    <rule ref="Generic.PHP.LowerCaseConstant" />
    <rule ref="Generic.PHP.SAPIUsage"/>
    <rule ref="Generic.PHP.Syntax" />
    <rule ref="Generic.WhiteSpace.DisallowTabIndent" />
    <rule ref="Generic.WhiteSpace.LanguageConstructSpacing" />
    <rule ref="Generic.WhiteSpace.ScopeIndent" />

    <!-- Added is_object because it's overused - strict typing, null checks or instanceof should be preferred -->
    <!-- There are some cases where this can be warranted (JSON decoding, for example) -->
    <rule ref="Generic.PHP.ForbiddenFunctions">
        <severity>7</severity>
        <properties>
            <property name="error" value="false" />
            <!-- temp removed: is_object=>null, -->
            <property name="forbiddenFunctions" type="array">
                <element key="sizeof" value="count" />
                <element key="delete" value="unset" />
                <element key="empty" value="null" />
            </property>
        </properties>
    </rule>

    <rule ref="PHPCompatibility">
        <exclude name="PSR12.Files.FileHeader.SpacingAfterTagBlock" />
    </rule>
</ruleset>
